<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Personalizado de Biologia</title>
    <!-- Carrega o Tailwind CSS para estiliza√ß√£o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Bibliotecas para Gerar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- O html2canvas foi removido, pois queremos um PDF de texto. -->
    <style>
        /* Fonte Inter (padr√£o do Tailwind) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Estiliza√ß√£o customizada para os bot√µes de r√°dio */
        /* Esconde o input de r√°dio padr√£o */
        input[type="radio"] {
            display: none;
        }

        /* Estilo base do label */
        input[type="radio"] + label {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 0.75rem; /* Ajustado para economizar espa√ßo */
            border: 2px solid #e2e8f0; /* cinza-300 */
            border-radius: 9999px; /* full */
            transition: all 0.2s ease-in-out;
            font-weight: 500;
        }

        /* Estilo do label quando o r√°dio est√° checado */
        /* N√≠vel Baixo */
        input[value="pouco"]:checked + label {
            background-color: #fee2e2; /* red-100 */
            border-color: #f87171; /* red-400 */
            color: #b91c1c; /* red-700 */
            font-weight: 600;
        }
        /* N√≠vel M√©dio */
        input[value="medio"]:checked + label {
            background-color: #fef9c3; /* yellow-100 */
            border-color: #facc15; /* yellow-400 */
            color: #a16207; /* yellow-700 */
            font-weight: 600;
        }
        /* N√≠vel Dominado */
        input[value="dominado"]:checked + label {
            background-color: #dcfce7; /* green-100 */
            border-color: #4ade80; /* green-400 */
            color: #15803d; /* green-700 */
            font-weight: 600;
        }

        /* Anima√ß√£o de fade-in para o modal */
        #plan-modal {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Container Principal -->
    <div class="container max-w-5xl mx-auto p-4 sm:p-8">
        
        <!-- Cabe√ßalho -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-700">Checklist Personalizado de Biologia - Mago do PISM</h1>
            <p class="text-lg text-gray-600 mt-2">Avalie seu n√≠vel de conhecimento no ENEM para gerar um plano de estudos.</p>
        </header>

        <!-- Se√ß√£o do Checklist -->
        <div id="checklist-section" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl">
            <!-- O conte√∫do do checklist ser√° injetado aqui pelo JavaScript -->
            <div id="checklist-container">
                <p class="text-center text-gray-500">Carregando t√≥picos...</p>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="flex flex-col sm:flex-row gap-4 mt-10">
                <button id="view-plan-btn" class="w-full sm:w-1/2 bg-blue-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-all duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300">
                    Ver Plano de Estudos
                </button>
                <button id="download-pdf-btn" class="w-full sm:w-1/2 bg-green-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-all duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-green-300">
                    Gerar PDF do Plano
                </button>
            </div>
        </div>
    </div> <!-- Fim do Container Principal -->

    <!-- Modal do Plano de Estudos (escondido por padr√£o) -->
    <!-- ESTA SE√á√ÉO FOI MOVIDA PARA C√Å (PARA FORA DO SCRIPT) -->
    <div id="plan-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50" style="display: none;">
        
        <!-- Conte√∫do do Modal -->
        <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            
            <!-- Cabe√ßalho do Modal -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-blue-700">Plano de estudos - Mago do PISM</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-700 text-3xl font-bold">&times;</button>
            </div>

            <!-- Corpo do Modal (com scroll) -->
            <div id="modal-content-to-print" class="p-6 sm:p-8 overflow-y-auto">
                <!-- Introdu√ß√£o do Plano -->
                <div class="mb-8 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                    <p class="text-gray-700">
                        Este plano foi gerado com base na sua autoavalia√ß√£o. A estrat√©gia √© focar sua energia onde ela √© mais necess√°ria.
                    </p>
                    <ul class="list-disc list-inside mt-2 space-y-1 text-gray-600">
                        <li><strong>Baixa Compreens√£o:</strong> Foco total. Dedique tempo para rever as aulas e os conceitos fundamentais sobre estes temas.</li>
                        <li><strong>Preciso Revisar:</strong> Foco em pr√°tica. Voc√™ j√° entendeu a base, agora √© hora de fixar com exerc√≠cios.</li>
                        <li><strong>Dominei o Conte√∫do:</strong> √ìtimo trabalho! Estes t√≥picos n√£o exigem revis√£o imediata. Siga em frente!</li>
                    </ul>
                </div>

                <!-- Se√ß√µes do Plano -->
                <div class="space-y-6">
                    <!-- N√≠vel 1: Rever Aulas -->
                    <section id="plan-pouco" class="plan-section">
                        <!-- Conte√∫do injetado pelo JS -->
                    </section>
                    
                    <!-- N√≠vel 2: Fazer Exerc√≠cios -->
                    <section id="plan-medio" class="plan-section">
                        <!-- Conte√∫do injetado pelo JS -->
                    </section>

                    <!-- N√≠vel 3: Dominado -->
                    <section id="plan-dominado" class="plan-section">
                        <!-- Conte√∫do injetado pelo JS -->
                    </section>
                </div>

                <!-- Bot√£o de PDF dentro do Modal -->
                <button id="modal-download-pdf-btn" class="w-full mt-8 bg-green-600 text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-all duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-green-300">
                    Baixar este Plano em PDF
                </button>
            </div>
        </div>
    </div>
    <!-- FIM DA SE√á√ÉO MOVIDA -->


    <script>
        // --- Defini√ß√£o dos T√≥picos de Biologia ---
        // (Baseado no conte√∫do program√°tico fornecido anteriormente)
        const topicosBiologia = [
            {
                categoria: "Seres vivos",
                itens: [
                    "Classifica√ß√£o dos seres vivos: sistem√°tica filogen√©tica",
                    "Classifica√ß√£o dos seres vivos: reinos e dom√≠nios",
                    "Evolu√ß√£o: origens da vida e transforma√ß√µes dos seres vivos ao longo do tempo",
                    "Evolu√ß√£o: estrat√©gias adaptativas",
                    "Evolu√ß√£o: mecanismos e teorias evolutivas e de sele√ß√£o",
                    "Evolu√ß√£o: biodiversidade",
                    "Bases da ecologia: ecossistemas e biomas",
                    "Bases da ecologia: fluxo de energia e de mat√©ria na biosfera",
                    "Bases da ecologia: cadeias e teias alimentares",
                    "Bases da ecologia: rela√ß√µes ecol√≥gicas",
                    "Bases da ecologia: ciclos biogeoqu√≠micos",
                    "Bases da ecologia: polui√ß√£o e desequil√≠brio ecol√≥gico"
                ]
            },
            {
                categoria: "V√≠rus, c√©lulas e tecidos",
                itens: [
                    "V√≠rus: estrutura; tipos; reprodu√ß√£o",
                    "C√©lulas procariotas e eucariotas: caracter√≠sticas morfol√≥gicas e funcionais",
                    "C√©lulas: principais componentes qu√≠micos",
                    "C√©lulas: mecanismos e fases da divis√£o celular",
                    "C√©lulas: sistema de biomembranas e mecanismos de transporte",
                    "C√©lulas: organelas",
                    "Bioenerg√©tica: respira√ß√£o celular",
                    "Bioenerg√©tica: fermenta√ß√£o",
                    "Bioenerg√©tica: fotoss√≠ntese",
                    "Bioenerg√©tica: quimioss√≠ntese",
                    "Multicelularidade: classifica√ß√£o, estrutura e fun√ß√µes dos tecidos animais e vegetais",
                    "Multicelularidade: desenvolvimento embrion√°rio dos animais",
                    "Multicelularidade: germina√ß√£o e dorm√™ncia"
                ]
            },
            {
                categoria: "Bases da gen√©tica",
                itens: [
                    "Os √°cidos nucleicos DNA e RNA: estrutura; fun√ß√µes",
                    "Cromossomos e genes: c√≥digo gen√©tico",
                    "Cromossomos e genes: s√≠ntese de prote√≠nas",
                    "Cromossomos e genes: muta√ß√£o e recombina√ß√£o g√™nica",
                    "Engenharia gen√©tica: tecnologia do DNA recombinante",
                    "Engenharia gen√©tica: c√©lulas-tronco",
                    "Hereditariedade: mendelismo e neomendelismo",
                    "Hereditariedade: doen√ßas heredit√°rias",
                    "Hereditariedade: altera√ß√µes no patrim√¥nio gen√©tico"
                ]
            },
            {
                categoria: "Bioqu√≠mica e fisiologia de animais e vegetais",
                itens: [
                    "Metabolismo: estrutura e cin√©tica de enzimas",
                    "Metabolismo: anabolismo e catabolismo de carboidratos, lip√≠dios e prote√≠nas",
                    "Metabolismo: tipos e fun√ß√µes dos horm√¥nios",
                    "Metabolismo: vitaminas",
                    "Processamento dos alimentos: digest√£o; absor√ß√£o e transporte de nutrientes nos animais",
                    "Processamento dos alimentos: capta√ß√£o de macro e micronutrientes pelos vegetais",
                    "Respira√ß√£o: mecanismos; √≥rg√£os e tecidos envolvidos; capta√ß√£o e transporte de gases",
                    "Circula√ß√£o: mecanismos; √≥rg√£os e tecidos envolvidos; transporte da seiva nas plantas",
                    "Excre√ß√£o nos animais: mechanisms; √≥rg√£os e tecidos envolvidos",
                    "Homeostasia: mecanismos termorregulat√≥rios; manuten√ß√£o do pH; osmorregula√ß√£o",
                    "Homeostasia: equil√≠brio hidrossalino e equil√≠brio √°cido-b√°sico",
                    "Sistema nervoso: estrutura; transmiss√£o do impulso nervoso",
                    "Reprodu√ß√£o: tipos de ciclos de vida; gametas e fecunda√ß√£o em animais e vegetais",
                    "O sistema imune animal: anticorpos; processos imunol√≥gicos"
                ]
            },
            {
                categoria: "Sa√∫de e bem-estar do homem",
                itens: [
                    "Doen√ßas infecciosas: agentes causadores; endemias, epidemias e pandemias; profilaxia",
                    "Infec√ß√µes sexualmente transmiss√≠veis (IST): agentes causadores e profilaxia",
                    "Doen√ßas parasit√°rias e carenciais no Brasil: agentes causadores; profilaxia",
                    "Medidas preventivas em sa√∫de p√∫blica: higiene; vacina√ß√£o"
                ]
            }
        ];

        // --- Fun√ß√µes do Aplicativo ---

        /**
         * Renderiza o checklist na p√°gina quando ela carrega.
         */
        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = ''; // Limpa o "Carregando..."
            let topicIndex = 0;

            topicosBiologia.forEach((categoria, catIndex) => {
                // Cria o t√≠tulo da categoria
                const categoryTitle = document.createElement('h2');
                categoryTitle.className = 'text-2xl font-bold text-gray-800 mt-8 mb-4 border-b-2 border-blue-200 pb-2';
                categoryTitle.textContent = categoria.categoria;
                container.appendChild(categoryTitle);

                // Cria os itens da categoria
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'space-y-4';

                categoria.itens.forEach((item) => {
                    const uniqueName = `topic_${topicIndex}`;
                    
                    const itemRow = document.createElement('div');
                    itemRow.className = 'topic-row flex flex-col sm:flex-row justify-between sm:items-center py-4 border-b border-gray-100';
                    // Armazena o nome do t√≥pico para f√°cil acesso ao gerar o plano
                    itemRow.setAttribute('data-topic-name', item);

                    // Nome do t√≥pico
                    const topicName = document.createElement('span');
                    topicName.className = 'text-md text-gray-700 mb-3 sm:mb-0 sm:w-2/5';
                    topicName.textContent = item;
                    itemRow.appendChild(topicName);

                    // Grupo de bot√µes de r√°dio
                    const radioGroup = document.createElement('div');
                    radioGroup.className = 'flex flex-wrap gap-2 sm:gap-4 justify-start sm:justify-end sm:w-3/5';
                    
                    // ESTA SE√á√ÉO FOI CORRIGIDA. O HTML do modal e o innerHTML duplicado foram removidos.
                    radioGroup.innerHTML = `
                        <div>
                            <input type="radio" id="${uniqueName}_pouco" name="${uniqueName}" value="pouco">
                            <label for="${uniqueName}_pouco">üò• Baixa</label>
                        </div>
                        <div>
                            <input type="radio" id="${uniqueName}_medio" name="${uniqueName}" value="medio">
                            <label for="${uniqueName}_medio">ü§î Revisar</label>
                        </div>
                        <div>
                            <input type="radio" id="${uniqueName}_dominado" name="${uniqueName}" value="dominado">
                            <label for="${uniqueName}_dominado">ü•∞ Dominei</label>
                        </div>
                    `;
                    itemRow.appendChild(radioGroup);
                    itemsContainer.appendChild(itemRow);
                    topicIndex++;
                });
                container.appendChild(itemsContainer);
            });
        }

        /**
         * Coleta os dados do checklist.
         * @returns {{pouco: string[], medio: string[], dominado: string[]}}
         */
        function getChecklistData() {
            const poucoDominio = [];
            const medioDominio = [];
            const dominado = [];

            // Seleciona todos os bot√µes de r√°dio que foram marcados
            const radiosSelecionados = document.querySelectorAll('input[type="radio"]:checked');

            radiosSelecionados.forEach(radio => {
                // Encontra a 'linha' (div.topic-row) pai para pegar o nome do t√≥pico
                const topicRow = radio.closest('.topic-row');
                const topicName = topicRow.dataset.topicName;
                const level = radio.value;

                if (level === 'pouco') {
                    poucoDominio.push(topicName);
                } else if (level === 'medio') {
                    medioDominio.push(topicName);
                } else if (level === 'dominado') {
                    dominado.push(topicName);
                }
            });
            return { pouco: poucoDominio, medio: medioDominio, dominado: dominado };
        }


        /**
         * Calcula e popula o plano de estudos no modal (sem exibi-lo).
         */
        function calcularEPopularPlano() {
            // A l√≥gica de coleta de dados foi movida para getChecklistData()
            const { pouco, medio, dominado } = getChecklistData();

            // Popula as se√ß√µes do modal
            populatePlanList(
                document.getElementById('plan-pouco'), 
                'üéØ Foco Total: Rever Aulas', 
                pouco,
                'Nenhum t√≥pico marcado com baixa compreens√£o. Muito bem!'
            );
            populatePlanList(
                document.getElementById('plan-medio'), 
                '‚úçÔ∏è Pr√°tica: Fazer Exerc√≠cios', 
                medio,
                'Nenhum t√≥pico marcado para revis√£o. Continue assim!'
            );
            populatePlanList(
                document.getElementById('plan-dominado'), 
                'üéâ Dominado: Revis√£o Opcional', 
                dominado,
                'Nenhum t√≥pico marcado como dominado ainda. Continue estudando!'
            );
        }

        /**
         * Fun√ß√£o auxiliar para popular as listas no modal.
         * @param {HTMLElement} container - O elemento da se√ß√£o (ex: #plan-pouco).
         * @param {string} title - O t√≠tulo da se√ß√£o (ex: 'Rever Aulas').
         * @param {string[]} items - Um array de nomes de t√≥picos.
         * @param {string} emptyMessage - Mensagem para exibir se a lista estiver vazia.
         */
        function populatePlanList(container, title, items, emptyMessage) {
            container.innerHTML = ''; // Limpa a se√ß√£o

            // Adiciona o t√≠tulo da se√ß√£o
            const h3 = document.createElement('h3');
            let titleClasses = 'text-xl font-semibold mb-3 ';
            if (title.includes('Foco Total')) titleClasses += 'text-red-600';
            if (title.includes('Pr√°tica')) titleClasses += 'text-yellow-600';
            if (title.includes('Dominado')) titleClasses += 'text-green-600';
            h3.className = titleClasses;
            h3.textContent = title;
            container.appendChild(h3);

            if (items.length > 0) {
                const ul = document.createElement('ul');
                ul.className = 'list-disc list-inside space-y-2 text-gray-700 pl-2';
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    ul.appendChild(li);
                });
                container.appendChild(ul);
            } else {
                // Exibe a mensagem de lista vazia
                const p = document.createElement('p');
                p.className = 'text-gray-500 italic';
                p.textContent = emptyMessage;
                container.appendChild(p);
            }
        }

        /**
         * Fecha o modal do plano de estudos.
         */
        function fecharModal() {
            document.getElementById('plan-modal').style.display = 'none';
        }

        /**
         * Abre o modal do plano de estudos.
         */
        function verPlano() {
            calcularEPopularPlano(); // Popula o conte√∫do
            document.getElementById('plan-modal').style.display = 'flex'; // Mostra o modal
        }

        /**
         * Gera e baixa um PDF em formato de TEXTO com o plano de estudos.
         * Esta fun√ß√£o usa jsPDF para construir o documento dinamicamente.
         */
        function gerarPDFTexto() {
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'pt', 'a4'); // Retrato, pontos, A4
                
                // 1. Obter os dados
                const data = getChecklistData();

                // 2. Configura√ß√µes do Documento
                const pageHeight = pdf.internal.pageSize.getHeight();
                const pageWidth = pdf.internal.pageSize.getWidth();
                const margin = 40;
                const maxLineWidth = pageWidth - margin * 2;
                let y = margin; // Posi√ß√£o Y atual

                // 3. Fun√ß√£o auxiliar para adicionar texto e quebrar p√°gina
                const addText = (text, options) => {
                    const { size = 10, style = 'normal', color = '#000000', spaceAfter = 12 } = options;
                    pdf.setFontSize(size);
                    pdf.setFont('helvetica', style); // Usar fontes base do PDF (Helvetica)
                    pdf.setTextColor(color);
                    
                    // Divide o texto em linhas que cabem na largura
                    const lines = pdf.splitTextToSize(text, maxLineWidth);
                    
                    lines.forEach(line => {
                        // Verifica se precisa de uma nova p√°gina
                        if (y + size > pageHeight - margin) {
                            pdf.addPage();
                            y = margin; // Reseta Y para o topo
                        }
                        pdf.text(line, margin, y);
                        y += (size * 1.2); // Avan√ßa Y (espa√ßamento 1.2)
                    });
                    
                    // Adiciona o espa√ßo extra ap√≥s o bloco de texto
                    y += (spaceAfter - (size * 1.2)); 
                };

                // --- In√≠cio do Conte√∫do do PDF ---

                // T√≠tulo Principal
                y += 10; 
                addText('Plano de estudos - Mago do PISM', { 
                    size: 18, 
                    style: 'bold', 
                    color: '#2563eb', // Azul
                    spaceAfter: 25 
                });

                // Bloco de Introdu√ß√£o
                addText('Este plano foi gerado com base na sua autoavalia√ß√£o. A estrat√©gia √© focar sua energia onde ela √© mais necess√°ria.', { 
                    size: 10, 
                    color: '#374151', // Cinza escuro
                    spaceAfter: 14 
                });
                addText('‚Ä¢ Baixa Compreens√£o: Foco total. Dedique tempo para rever as aulas e os conceitos fundamentais sobre estes temas.', { 
                    size: 10, 
                    style: 'bold', 
                    color: '#dc2626', // Vermelho
                    spaceAfter: 14 
                });
                addText('‚Ä¢ Preciso Revisar: Foco em pr√°tica. Voc√™ j√° entendeu a base, agora √© hora de fixar com exerc√≠cios.', { 
                    size: 10, 
                    style: 'bold', 
                    color: '#d97706', // Amarelo/Laranja
                    spaceAfter: 14 
                });
                addText('‚Ä¢ Dominei o Conte√∫do: √ìtimo trabalho! Estes t√≥picos n√£o exigem revis√£o imediata. Siga em frente!', { 
                    size: 10, 
                    style: 'bold', 
                    color: '#16a34a', // Verde
                    spaceAfter: 14 
                });
                y += 20; // Espa√ßo extra ap√≥s a intro

                // Fun√ß√£o auxiliar para adicionar se√ß√µes de lista
                const addListSection = (title, color, items, emptyMsg) => {
                    if (y + 40 > pageHeight - margin) { 
                        pdf.addPage();
                        y = margin;
                    }
                    addText(title, { 
                        size: 14, 
                        style: 'bold', 
                        color: color, 
                        spaceAfter: 16 
                    });
                    
                    if (items.length > 0) {
                        items.forEach(item => {
                            addText(`‚Ä¢ ${item}`, { 
                                size: 10, 
                                color: '#374151', 
                                spaceAfter: 14 
                            });
                        });
                    } else {
                        addText(emptyMsg, { 
                            size: 10, 
                            style: 'italic', 
                            color: '#6b7280', 
                            spaceAfter: 14 
                        });
                    }
                    y += 15; // Espa√ßo entre se√ß√µes
                };

                // --- Se√ß√£o 1: Foco Total ---
                addListSection(
                    'üéØ Foco Total: Rever Aulas', 
                    '#dc2626', // Vermelho
                    data.pouco, 
                    'Nenhum t√≥pico marcado com baixa compreens√£o. Muito bem!'
                );
                
                // --- Se√ß√£o 2: Pr√°tica ---
                addListSection(
                    '‚úçÔ∏è Pr√°tica: Fazer Exerc√≠cios', 
                    '#d97706', // Amarelo/Laranja
                    data.medio, 
                    'Nenhum t√≥pico marcado para revis√£o. Continue assim!'
                );
                
                // --- Se√ß√£o 3: Dominado ---
                addListSection(
                    'üéâ Dominado: Revis√£o Opcional', 
                    '#16a34a', // Verde
                    data.dominado, 
                    'Nenhum t√≥pico marcado como dominado ainda. Continue estudando!'
                );

                // --- Salvar o PDF ---
                pdf.save('Plano_Estudos_Biologia_Mago_do_PISM.pdf');

            } catch (err) {
                console.error("Erro ao gerar PDF de texto:", err);
                // N√£o usamos alert() aqui
            }
        }


        // --- Event Listeners ---

        // Renderiza o checklist assim que o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', renderChecklist);

        // A√ß√£o dos novos bot√µes
        document.getElementById('view-plan-btn').addEventListener('click', verPlano);
        
        // Bot√£o de Download Externo (corrigido)
        /* CORRE√á√ÉO: Removido 'async' e '.then()' e usando try/catch s√≠ncrono */
        document.getElementById('download-pdf-btn').addEventListener('click', function() {
            const btn = this;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Gerando...';
            btn.disabled = true;

            try {
                // Chama a nova fun√ß√£o s√≠ncrona de gera√ß√£o de texto
                gerarPDFTexto();
            } catch (err) {
                console.error("Erro ao gerar PDF:", err);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // Bot√£o de Download Interno (no modal) (corrigido)
        /* CORRE√á√ÉO: Removido 'async' e '.then()' e usando try/catch s√≠ncrono */
        document.getElementById('modal-download-pdf-btn').addEventListener('click', function() {
            const btn = this;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Gerando...';
            btn.disabled = true;
            
            try {
                // Chama a mesma fun√ß√£o de gera√ß√£o de PDF
                gerarPDFTexto();
            } catch (err) {
                console.error("Erro ao gerar PDF:", err);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });


        // A√ß√µes para fechar o modal
        document.getElementById('close-modal-btn').addEventListener('click', fecharModal);
        document.getElementById('plan-modal').addEventListener('click', (event) => {
            // Fecha o modal se o usu√°rio clicar fora do conte√∫do (no overlay)
            if (event.target === event.currentTarget) {
                fecharModal();
            }
        });
    </script>
</body>
</html>
